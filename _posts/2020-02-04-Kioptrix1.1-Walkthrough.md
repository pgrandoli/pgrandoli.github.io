---
layout: post
title: Kioptrix 1.1 - Walkthrough
date: 2020-02-04 20:44
description: Walkthrough - Kioptrix 1.1
toc: true
comments: true
tags: 
 - OSCP

---

## **Walkthrough de Kioptrix 1**
---

## **Links**
[Kioptrix 1.1 en Vulnhub](https://www.vulnhub.com/entry/kioptrix-level-11-2,23/)


## **Reconocimiento**
---
>**`nmap -T4 -p- 10.0.0.107`**

```console
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-03 16:37 AKST
Nmap scan report for 10.0.0.107
Host is up (0.0028s latency).
Not shown: 65528 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
443/tcp  open  https
622/tcp  open  collaborator
631/tcp  open  ipp
3306/tcp open  mysql
MAC Address: 00:0C:29:B1:91:AA (VMware)

Nmap done: 1 IP address (1 host up) scanned in 4.05 seconds

```

>**`nmap -A -T4 -p 22,80,111,443,622,631,3306 -oA Kioptrix1.1`**

```console
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-03 16:39 AKST
Nmap scan report for 10.0.0.107
Host is up (0.00013s latency).

PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 3.9p1 (protocol 1.99)
| ssh-hostkey:
|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)
|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)
|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)
|_sshv1: Server supports SSHv1
80/tcp   open  http       Apache httpd 2.0.52 ((CentOS))
|_http-server-header: Apache/2.0.52 (CentOS)
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
111/tcp  open  rpcbind    2 (RPC #100000)
443/tcp  open  ssl/https?
|_ssl-date: 2020-02-03T23:30:15+00:00; -2h09m37s from scanner time.
| sslv2:
|   SSLv2 supported
|   ciphers:
|     SSL2_RC2_128_CBC_WITH_MD5
|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5
|     SSL2_DES_192_EDE3_CBC_WITH_MD5
|     SSL2_RC4_128_EXPORT40_WITH_MD5
|     SSL2_RC4_128_WITH_MD5
|     SSL2_DES_64_CBC_WITH_MD5
|_    SSL2_RC4_64_WITH_MD5
622/tcp  open  status     1 (RPC #100024)
631/tcp  open  ipp        CUPS 1.1
| http-methods:
|_  Potentially risky methods: PUT
|_http-server-header: CUPS/1.1
|_http-title: 403 Forbidden
3306/tcp open  mysql      MySQL (unauthorized)
MAC Address: 00:0C:29:B1:91:AA (VMware)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.30
Network Distance: 1 hop

Host script results:
|_clock-skew: -2h09m37s

TRACEROUTE
HOP RTT     ADDRESS
1   0.13 ms 10.0.0.107

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 106.08 seconds
```

### **Protocolo SSH**

>**``ssh 10.0.0.107``**


### **Protocolo HTTP (80 y 443)**

>**``nikto -h 10.0.0.107``**

```console
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.0.0.107
+ Target Hostname:    10.0.0.107
+ Target Port:        80
+ Start Time:         2020-02-04 06:11:59 (GMT-9)
---------------------------------------------------------------------------
+ Server: Apache/2.0.52 (CentOS)
+ Retrieved x-powered-by header: PHP/4.3.9
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Apache/2.0.52 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ Uncommon header 'tcn' found, with contents: choice
+ OSVDB-3092: /manual/: Web server manual found.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3268: /manual/images/: Directory indexing found.
+ Server may leak inodes via ETags, header found with file /icons/README, inode: 357810, size: 4872, mtime: Sat Mar 29 08:41:04 1980
+ OSVDB-3233: /icons/README: Apache default file found.
+ 8699 requests: 1 error(s) and 17 item(s) reported on remote host
+ End Time:           2020-02-04 06:12:59 (GMT-9) (60 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
## **Explotación**

Empezando por la parte web hay un formulario de login esperando en la raiz del servidor, explorando el código fuente del html no se encuentra mucho pero si hubo éxito al momento de probar una ataque de [sqli](https://www.elladodelmal.com/2007/07/sql-injection-level-1.html) básico.

![img]({{ '/assets/images/Vulnhub/Kioptrix1.1/sqli.png' | relative_url }}){: .center-image }*(°0°)*

Lo que nos lleva a una página que aparentemente ejecuta el comando ``ping`` y devuelve el resultado:

![img]({{ '/assets/images/vulnhub/kioptrix1.1/ping_00.png' | relative_url }}){: .center-image }*(°0°)*



![img]({{ '/assets/images/vulnhub/kioptrix1.1/ping_01.png' | relative_url }}){: .center-image }*(°0°)*


Bien, si está página ejecuta el comando ping entonces quiero probar si concatenando con otro comando también es ejecutado. Para concatenar comandos se utiliza el caracter pipe ``|`` seguido del otro comando, en la imágen queda de la siguiente manera:

![img]({{ '/assets/images/vulnhub/kioptrix1.1/passwd_00.png' | relative_url }}){: .center-image }*(°0°)*

y se puede ver que efectivamente lo ejecuta y me muestra en pantalla la información contenida dentro del archivo ``/etc/passwd``

![img]({{ '/assets/images/vulnhub/kioptrix1.1/ping_01.png' | relative_url }}){: .center-image }*(°0°)*


